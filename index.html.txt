<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WB Coworking | Sistema Oficial</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        wb: {
                            black: '#050505',
                            panel: '#101010',
                            gold: '#d4af37',
                            goldHover: '#b5952f',
                            gray: '#333333',
                            error: '#ef4444'
                        }
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* CSS Personalizado para detalhes finos */
        body { background-color: #050505; color: #e5e5e5; }
        
        /* Input Estilizado */
        .input-wb {
            background-color: #0a0a0a;
            border: 1px solid #333;
            color: white;
            transition: all 0.3s ease;
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
        }
        .input-wb:focus {
            border-color: #d4af37;
            outline: none;
            box-shadow: 0 0 0 1px #d4af37;
        }

        /* Bot√£o Premium */
        .btn-gold {
            background: linear-gradient(to right, #d4af37, #c5a028);
            color: #000;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.2s, filter 0.2s;
        }
        .btn-gold:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        /* Transi√ß√µes de Tela */
        .screen { display: none; opacity: 0; animation: fadeIn 0.4s forwards; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Grade de Hor√°rios */
        .slot-btn {
            background: #111; border: 1px solid #333; color: #888;
            padding: 10px; border-radius: 6px; transition: 0.2s;
        }
        .slot-btn:hover:not(:disabled) { border-color: #d4af37; color: #d4af37; }
        .slot-btn.selected { background: #d4af37; color: #000; border-color: #d4af37; font-weight: bold; }
        .slot-btn:disabled { opacity: 0.3; cursor: not-allowed; text-decoration: line-through; background: #000; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="border-b border-wb-gray/50 bg-black/95 sticky top-0 z-50 backdrop-blur-sm">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-serif font-bold text-wb-gold tracking-widest">WB COWORKING</h1>
            
            <div id="userHeader" class="hidden flex items-center gap-4">
                <div class="text-right hidden md:block">
                    <p class="text-[10px] text-gray-500 uppercase tracking-wider">Advogado(a)</p>
                    <p id="headerUserName" class="text-sm font-bold text-wb-gold">Nome</p>
                </div>
                <button onclick="logout()" class="text-xs border border-gray-600 px-3 py-1 rounded text-gray-400 hover:text-white hover:border-white transition">SAIR</button>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 relative">

        <section id="screen-login" class="screen active max-w-lg mx-auto mt-10">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-serif text-white mb-2">Bem-vindo</h2>
                <p class="text-gray-500 text-sm">Identifique-se para acessar sua √°rea exclusiva.</p>
            </div>

            <div class="bg-wb-panel p-8 rounded-xl border border-wb-gray/50 shadow-2xl">
                <form id="loginForm" class="space-y-5">
                    
                    <div>
                        <label class="block text-xs font-bold text-wb-gold uppercase mb-1">Nome Completo</label>
                        <input type="text" id="inputName" required class="input-wb" placeholder="Dr. Seu Nome">
                    </div>

                    <div>
                        <div class="flex gap-4 mb-2">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="docType" value="cpf" checked onchange="toggleDocMask('cpf')" class="accent-wb-gold">
                                <span class="text-xs font-bold text-gray-300">CPF</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="radio" name="docType" value="oab" onchange="toggleDocMask('oab')" class="accent-wb-gold">
                                <span class="text-xs font-bold text-gray-300">OAB</span>
                            </label>
                        </div>
                        <input type="text" id="inputDoc" required class="input-wb" placeholder="000.000.000-00">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-wb-gold uppercase mb-1">E-mail Profissional</label>
                        <input type="email" id="inputEmail" required list="emailList" class="input-wb" placeholder="seu@email.com">
                        <datalist id="emailList">
                            <option value="@gmail.com">
                            <option value="@hotmail.com">
                            <option value="@outlook.com">
                            <option value="@adv.oabsp.org.br">
                            <option value="@yahoo.com.br">
                        </datalist>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-wb-gold uppercase mb-1">WhatsApp (Celular)</label>
                        <input type="tel" id="inputPhone" required class="input-wb" placeholder="(11) 9xxxx-xxxx">
                        <p class="text-[10px] text-gray-600 mt-1">Obrigat√≥rio d√≠gito 9 e DDD.</p>
                    </div>

                    <button type="submit" class="btn-gold w-full py-4 rounded-lg mt-4 shadow-lg">ACESSAR SISTEMA</button>
                </form>
            </div>
        </section>

        <section id="screen-menu" class="screen max-w-4xl mx-auto pt-8">
            <h2 class="text-2xl font-serif text-white text-center mb-8">O que deseja fazer?</h2>
            
            <div class="grid md:grid-cols-3 gap-6">
                <div onclick="navTo('booking')" class="group bg-wb-panel p-6 rounded-xl border border-wb-gray hover:border-wb-gold cursor-pointer transition text-center">
                    <div class="text-4xl mb-4 group-hover:scale-110 transition">üìÖ</div>
                    <h3 class="text-lg font-bold text-white">Agendar Sala</h3>
                    <p class="text-xs text-gray-500 mt-2">Reservar hor√°rios avulsos ou di√°ria completa.</p>
                </div>

                <div onclick="navTo('history')" class="group bg-wb-panel p-6 rounded-xl border border-wb-gray hover:border-wb-gold cursor-pointer transition text-center">
                    <div class="text-4xl mb-4 group-hover:scale-110 transition">üìÇ</div>
                    <h3 class="text-lg font-bold text-white">Minhas Reservas</h3>
                    <p class="text-xs text-gray-500 mt-2">Ver hist√≥rico e comprovantes.</p>
                </div>

                <div onclick="openSupport()" class="group bg-wb-panel p-6 rounded-xl border border-wb-gray hover:border-wb-gold cursor-pointer transition text-center">
                    <div class="text-4xl mb-4 group-hover:scale-110 transition">üí¨</div>
                    <h3 class="text-lg font-bold text-white">Suporte VIP</h3>
                    <p class="text-xs text-gray-500 mt-2">Falar com a recep√ß√£o no WhatsApp.</p>
                </div>
            </div>
        </section>

        <section id="screen-booking" class="screen max-w-3xl mx-auto">
            <button onclick="navTo('menu')" class="mb-6 text-gray-500 hover:text-wb-gold flex items-center text-sm">‚Üê Voltar</button>
            
            <div class="bg-wb-panel p-6 md:p-8 rounded-xl border border-wb-gray">
                <h3 class="text-2xl font-serif text-wb-gold mb-6">Nova Reserva</h3>

                <div class="mb-8">
                    <label class="block text-sm text-white mb-2">Selecione o Dia</label>
                    <input type="date" id="datePicker" class="input-wb text-white [color-scheme:dark]">
                    <p id="dateMsg" class="text-xs text-red-500 mt-2 hidden">N√£o funcionamos aos finais de semana.</p>
                </div>

                <div id="slotsContainer" class="hidden">
                    <p class="text-sm text-gray-400 mb-3">Hor√°rios Dispon√≠veis (Clique para selecionar)</p>
                    <div id="slotsGrid" class="grid grid-cols-4 gap-3 mb-6"></div>

                    <div class="border-t border-wb-gray pt-6 flex justify-between items-center">
                        <div>
                            <p class="text-xs text-gray-500 uppercase">Total Estimado</p>
                            <p id="totalPrice" class="text-2xl font-serif text-wb-gold">R$ 0,00</p>
                        </div>
                        <button onclick="confirmBooking()" class="btn-gold px-8 py-3 rounded shadow-lg">CONFIRMAR</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="screen-history" class="screen max-w-3xl mx-auto">
            <button onclick="navTo('menu')" class="mb-6 text-gray-500 hover:text-wb-gold flex items-center text-sm">‚Üê Voltar</button>
            <h3 class="text-2xl font-serif text-white mb-6">Meus Agendamentos</h3>
            <div id="bookingList" class="space-y-4">
                </div>
        </section>

    </main>

    <footer class="py-6 bg-black border-t border-wb-gray/30 text-center mt-auto">
        <p class="text-wb-gold text-xs font-bold tracking-widest">WB COWORKING</p>
        <p class="text-[10px] text-gray-600 mt-1">SISTEMA EXCLUSIVO PARA ADVOGADOS</p>
    </footer>

    <script>
        // --- CONFIGURA√á√ÉO ---
        const HOUR_PRICE = 50;
        const BUSINESS_HOURS = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
        const WHATSAPP_SUPPORT = "5511914258886";

        // --- ESTADO GLOBAL ---
        let user = JSON.parse(localStorage.getItem('wb_user')) || null;
        let bookings = JSON.parse(localStorage.getItem('wb_bookings')) || [];
        let currentDocMode = 'cpf';
        let bookingSelection = { date: null, slots: [] };

        // --- INICIALIZA√á√ÉO ---
        window.onload = () => {
            // Configurar m√°scaras nos inputs
            setupMasks();
            
            // Verificar login
            if(user) {
                updateUserInterface();
                navTo('menu');
            } else {
                navTo('login');
            }
        };

        // --- 1. M√ÅSCARAS E VALIDA√á√ïES (O Cora√ß√£o do Sistema) ---
        
        function setupMasks() {
            const inputDoc = document.getElementById('inputDoc');
            const inputPhone = document.getElementById('inputPhone');

            // M√°scara de Documento (Din√¢mica)
            inputDoc.addEventListener('input', (e) => {
                let v = e.target.value;
                if(currentDocMode === 'cpf') {
                    v = v.replace(/\D/g, ""); // Apenas n√∫meros
                    if(v.length > 11) v = v.slice(0, 11);
                    v = v.replace(/(\d{3})(\d)/, "$1.$2");
                    v = v.replace(/(\d{3})(\d)/, "$1.$2");
                    v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
                } else {
                    // OAB: UF/NUMERO
                    // Permite letras e n√∫meros, for√ßa uppercase
                    v = v.toUpperCase().replace(/[^A-Z0-9]/g, "");
                    if(v.length > 2) {
                        // Tenta achar onde termina a UF (geralmente 2 letras)
                        if(/^\D{2}\d/.test(v)) { 
                            v = v.replace(/^([A-Z]{2})(\d)/, "$1/$2");
                        }
                    }
                }
                e.target.value = v;
            });

            // M√°scara de Telefone (R√≠gida)
            inputPhone.addEventListener('input', (e) => {
                let v = e.target.value.replace(/\D/g, "");
                if(v.length > 11) v = v.slice(0, 11); // Limita a 11 digitos

                // Formata: (11) 91234-5678
                if(v.length > 7) v = `(${v.substring(0,2)}) ${v.substring(2,7)}-${v.substring(7)}`;
                else if(v.length > 2) v = `(${v.substring(0,2)}) ${v.substring(2)}`;
                else if(v.length > 0) v = `(${v}`;
                
                e.target.value = v;
            });
        }

        function toggleDocMask(type) {
            currentDocMode = type;
            const input = document.getElementById('inputDoc');
            input.value = '';
            input.placeholder = type === 'cpf' ? '000.000.000-00' : 'UF/000000';
            input.focus();
        }

        // --- 2. AUTENTICA√á√ÉO ---

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('inputName').value;
            const doc = document.getElementById('inputDoc').value;
            const email = document.getElementById('inputEmail').value;
            const phone = document.getElementById('inputPhone').value;
            const rawPhone = phone.replace(/\D/g, '');
            const rawDoc = doc.replace(/\D/g, '');

            // VALIDA√á√ïES FINAIS
            if(rawPhone.length !== 11) return alert("Erro: O telefone precisa ter DDD + 9 d√≠gitos.");
            if(rawPhone[2] !== '9') return alert("Erro: O n√∫mero de celular deve come√ßar com 9.");
            
            if(currentDocMode === 'cpf' && rawDoc.length !== 11) return alert("Erro: CPF inv√°lido.");
            if(currentDocMode === 'oab' && doc.length < 5) return alert("Erro: OAB inv√°lida.");

            // Salvar Usu√°rio
            user = { name, doc, email, phone };
            localStorage.setItem('wb_user', JSON.stringify(user));
            
            updateUserInterface();
            navTo('menu');
        });

        function logout() {
            localStorage.removeItem('wb_user');
            user = null;
            document.getElementById('userHeader').classList.add('hidden');
            document.getElementById('inputName').value = '';
            document.getElementById('inputDoc').value = '';
            document.getElementById('inputPhone').value = '';
            document.getElementById('inputEmail').value = '';
            navTo('login');
        }

        function updateUserInterface() {
            document.getElementById('headerUserName').innerText = user.name.split(' ')[0];
            document.getElementById('userHeader').classList.remove('hidden');
        }

        // --- 3. NAVEGA√á√ÉO ---
        
        function navTo(screenName) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(`screen-${screenName}`).classList.add('active');
            window.scrollTo(0,0);

            if(screenName === 'history') renderHistory();
        }

        function openSupport() {
            const text = `Ol√°, sou ${user.name}. Preciso de ajuda com o Coworking.`;
            window.open(`https://wa.me/${WHATSAPP_SUPPORT}?text=${encodeURIComponent(text)}`, '_blank');
        }

        // --- 4. AGENDAMENTO ---

        // Configurar data m√≠nima (hoje)
        const datePicker = document.getElementById('datePicker');
        datePicker.min = new Date().toISOString().split('T')[0];

        datePicker.addEventListener('change', function() {
            const dateVal = this.value;
            if(!dateVal) return;

            const dateObj = new Date(dateVal);
            const day = dateObj.getUTCDay(); // 0 = Dom, 6 = Sab

            if(day === 0 || day === 6) {
                document.getElementById('dateMsg').classList.remove('hidden');
                document.getElementById('slotsContainer').classList.add('hidden');
                this.value = '';
                return;
            }

            document.getElementById('dateMsg').classList.add('hidden');
            bookingSelection.date = dateVal;
            bookingSelection.slots = [];
            renderSlots();
            document.getElementById('slotsContainer').classList.remove('hidden');
        });

        function renderSlots() {
            const grid = document.getElementById('slotsGrid');
            grid.innerHTML = '';
            updateTotal();

            BUSINESS_HOURS.forEach(h => {
                const btn = document.createElement('button');
                btn.className = 'slot-btn';
                btn.innerText = h;

                // Verifica se j√° est√° ocupado no "banco de dados" local
                const isTaken = bookings.some(b => 
                    b.date === bookingSelection.date && 
                    b.slots.includes(h) && 
                    b.status !== 'cancelado'
                );

                if(isTaken) {
                    btn.disabled = true;
                    btn.title = "Hor√°rio Indispon√≠vel";
                } else {
                    btn.onclick = () => {
                        // Toggle sele√ß√£o
                        if(bookingSelection.slots.includes(h)) {
                            bookingSelection.slots = bookingSelection.slots.filter(s => s !== h);
                            btn.classList.remove('selected');
                        } else {
                            bookingSelection.slots.push(h);
                            btn.classList.add('selected');
                        }
                        updateTotal();
                    };
                }
                grid.appendChild(btn);
            });
        }

        function updateTotal() {
            const total = bookingSelection.slots.length * HOUR_PRICE;
            document.getElementById('totalPrice').innerText = `R$ ${total},00`;
        }

        function confirmBooking() {
            if(bookingSelection.slots.length === 0) return alert("Por favor, selecione pelo menos um hor√°rio.");

            const newBooking = {
                id: Date.now(),
                userDoc: user.doc,
                date: bookingSelection.date,
                slots: bookingSelection.slots.sort(), // Ordena hor√°rios
                total: bookingSelection.slots.length * HOUR_PRICE,
                status: 'confirmado',
                createdAt: new Date().toISOString()
            };

            bookings.push(newBooking);
            localStorage.setItem('wb_bookings', JSON.stringify(bookings));

            alert(`Agendamento Confirmado!\nData: ${newBooking.date}\nHor√°rios: ${newBooking.slots.join(', ')}`);
            
            // Limpa e redireciona
            document.getElementById('datePicker').value = '';
            bookingSelection = { date: null, slots: [] };
            navTo('history');
        }

        // --- 5. HIST√ìRICO ---

        function renderHistory() {
            const list = document.getElementById('bookingList');
            list.innerHTML = '';
            
            // Filtra agendamentos do usu√°rio logado
            const myBookings = bookings.filter(b => b.userDoc === user.doc).sort((a,b) => b.id - a.id);

            if(myBookings.length === 0) {
                list.innerHTML = '<p class="text-center text-gray-500 py-10">Nenhuma reserva encontrada.</p>';
                return;
            }

            myBookings.forEach(b => {
                const isCanceled = b.status === 'cancelado';
                const dateDisplay = b.date.split('-').reverse().join('/');
                
                const item = document.createElement('div');
                item.className = `bg-wb-panel border ${isCanceled ? 'border-red-900/50' : 'border-wb-gray'} p-4 rounded-lg flex flex-col md:flex-row justify-between items-center gap-4`;
                
                item.innerHTML = `
                    <div class="text-left w-full">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-wb-gold font-bold text-lg">${dateDisplay}</span>
                            ${isCanceled 
                                ? '<span class="text-xs bg-red-900 text-red-200 px-2 rounded">CANCELADO</span>' 
                                : '<span class="text-xs bg-green-900 text-green-200 px-2 rounded">CONFIRMADO</span>'}
                        </div>
                        <p class="text-gray-400 text-sm">Hor√°rios: ${b.slots.join(' | ')}</p>
                        <p class="text-gray-500 text-xs mt-1">Valor: R$ ${b.total},00</p>
                    </div>
                `;

                if(!isCanceled) {
                    const btnCancel = document.createElement('button');
                    btnCancel.className = "text-xs text-red-500 hover:text-red-400 border border-red-900 hover:bg-red-900/20 px-4 py-2 rounded transition whitespace-nowrap";
                    btnCancel.innerText = "Cancelar Reserva";
                    btnCancel.onclick = () => cancelBooking(b.id);
                    item.appendChild(btnCancel);
                }

                list.appendChild(item);
            });
        }

        function cancelBooking(id) {
            // Regra de Cancelamento (Simula√ß√£o)
            if(confirm("Tem certeza que deseja cancelar? \n(Cancelamentos com menos de 12h est√£o sujeitos a multa).")) {
                const index = bookings.findIndex(b => b.id === id);
                if(index !== -1) {
                    bookings[index].status = 'cancelado';
                    localStorage.setItem('wb_bookings', JSON.stringify(bookings));
                    renderHistory();
                }
            }
        }

    </script>
</body>
</html>