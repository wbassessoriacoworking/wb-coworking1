<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WB Coworking | Exclusive Law</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        :root {
            --bg-main: #000000;
            --bg-card: #111111;
            --text-gold: #D4AF37;
            --text-white: #ffffff;
            --text-gray: #888888;
            --input-bg: #1a1a1a;
            --input-border: #333333;
        }
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: var(--bg-main); color: var(--text-white); display: flex; flex-direction: column; min-height: 100vh; }
        
        /* HEADER */
        .header { display: flex; justify-content: space-between; padding: 20px; align-items: center; border-bottom: 1px solid #222; }
        .logo { color: var(--text-gold); font-weight: bold; letter-spacing: 2px; font-size: 1.2rem; }
        .user-area { font-size: 0.8rem; color: var(--text-gray); text-align: right; }
        .btn-sair { background: none; border: 1px solid #444; color: #666; padding: 2px 10px; cursor: pointer; margin-left: 10px; border-radius: 4px; }

        /* CONTENT */
        .main-container { flex: 1; padding: 20px; width: 100%; max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; justify-content: center; }
        
        /* CARDS & TEXTS */
        .title-gold { color: var(--text-gold); text-align: center; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .subtitle { text-align: center; color: var(--text-gray); margin-bottom: 25px; font-size: 0.9rem; }
        .dark-card { background: var(--bg-card); padding: 25px; border-radius: 10px; border: 1px solid var(--input-border); box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        
        /* INPUTS */
        label { display: block; color: var(--text-gold); font-size: 0.75rem; margin-bottom: 5px; font-weight: bold; letter-spacing: 0.5px; margin-top: 15px; }
        input, select { width: 100%; padding: 12px; background: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-white); border-radius: 5px; box-sizing: border-box; font-size: 1rem; }
        input:focus { border-color: var(--text-gold); outline: none; }
        
        /* BUTTONS */
        .btn-gold { width: 100%; padding: 15px; background: linear-gradient(135deg, #D4AF37, #bfa030); color: #000; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1rem; margin-top: 20px; transition: 0.3s; }
        .btn-gold:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn-link { background: none; border: none; color: var(--text-gray); text-decoration: underline; cursor: pointer; width: 100%; margin-top: 15px; }
        .btn-back { background: none; border: none; color: var(--text-gold); cursor: pointer; margin-bottom: 15px; display: flex; align-items: center; font-size: 0.9rem; }

        /* DASHBOARD GRID */
        .dash-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .dash-btn { background: var(--bg-card); padding: 20px; border: 1px solid var(--input-border); border-radius: 8px; display: flex; align-items: center; cursor: pointer; transition: 0.3s; }
        .dash-btn:hover { border-color: var(--text-gold); background: #151515; }
        .dash-icon { font-size: 1.5rem; margin-right: 15px; color: var(--text-gold); }
        .dash-text h4 { margin: 0; color: white; }
        .dash-text p { margin: 2px 0 0 0; font-size: 0.8rem; color: #666; }

        /* UTILS */
        .hidden { display: none; }
        section { animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* SLOTS (Hor√°rios) */
        .slots { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .slot { background: #222; color: #fff; padding: 10px; text-align: center; border-radius: 4px; cursor: pointer; border: 1px solid #333; font-size: 0.9rem; }
        .slot:hover { border-color: var(--text-gold); }
        .slot.selected { background: var(--text-gold); color: #000; border-color: var(--text-gold); font-weight: bold; }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo">WB | ADV</div>
        <div id="userInfo" class="user-area hidden">
            Ol√°, <span id="headerUserName">Dr.</span>
            <button class="btn-sair" onclick="doLogout()">Sair</button>
        </div>
    </header>

    <main class="main-container">

        <section id="screen-login" class="active">
            <h2 class="title-gold">Acesso Restrito</h2>
            <p class="subtitle">√Årea exclusiva para advogados associados.</p>
            
            <div class="dark-card">
                <label>E-MAIL</label>
                <input type="email" id="loginEmail" placeholder="seu@email.com">
                <label>SENHA</label>
                <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                
                <button class="btn-gold" onclick="doLogin()">ENTRAR</button>
                <button class="btn-link" onclick="goTo('screen-register')">N√£o tem cadastro? Clique aqui.</button>
            </div>
        </section>

        <section id="screen-register" class="hidden">
            <h2 class="title-gold">Novo Associado</h2>
            <p class="subtitle">Preencha seus dados profissionais.</p>
            
            <div class="dark-card">
                <label>NOME COMPLETO</label>
                <input type="text" id="regName" placeholder="Dr. Fulano de Tal">

                <label>CPF</label>
                <input type="text" id="regCPF" placeholder="000.000.000-00" maxlength="14" oninput="maskCPF(this)">

                <label>OAB (UF/N√öMERO)</label>
                <input type="text" id="regOAB" placeholder="SP/123456" maxlength="10" oninput="maskOAB(this)">

                <label>WHATSAPP</label>
                <input type="tel" id="regPhone" placeholder="(11) 99999-9999" maxlength="15" oninput="maskPhone(this)">

                <label>E-MAIL</label>
                <input type="email" id="regEmail" placeholder="exemplo@gmail.com">

                <label>SENHA</label>
                <input type="password" id="regPass" placeholder="Crie uma senha segura">

                <button class="btn-gold" onclick="doRegister()">FINALIZAR CADASTRO</button>
                <button class="btn-link" onclick="goTo('screen-login')">J√° tenho conta. Voltar.</button>
            </div>
        </section>

        <section id="screen-home" class="hidden">
            <h2 class="title-gold">Painel do Advogado</h2>
            <p class="subtitle">Bem-vindo, <span id="dashName">Doutor</span>.</p>
            
            <div class="dash-grid">
                <div class="dash-btn" onclick="goTo('screen-booking')">
                    <span class="dash-icon">üìÖ</span>
                    <div class="dash-text">
                        <h4>Nova Reserva</h4>
                        <p>Agende sala de reuni√£o ou esta√ß√£o.</p>
                    </div>
                </div>
                
                <div class="dash-btn" onclick="goTo('screen-appointments')">
                    <span class="dash-icon">‚öñÔ∏è</span>
                    <div class="dash-text">
                        <h4>Minhas Reservas</h4>
                        <p>Consulte seus hor√°rios agendados.</p>
                    </div>
                </div>

                <div class="dash-btn" onclick="goTo('screen-support')">
                    <span class="dash-icon">üí¨</span>
                    <div class="dash-text">
                        <h4>Suporte WB</h4>
                        <p>Contato direto via WhatsApp.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="screen-booking" class="hidden">
            <button class="btn-back" onclick="goTo('screen-home')">‚¨Ö Voltar</button>
            <h2 class="title-gold">Reservar Sala</h2>
            
            <div class="dark-card">
                <label>DATA</label>
                <input type="date" id="dateInput" style="color-scheme: dark;">

                <div id="timeSection" class="hidden">
                    <label>HOR√ÅRIO DISPON√çVEL</label>
                    <div class="slots" id="slotsContainer"></div>
                </div>

                <div id="paymentSection" class="hidden" style="margin-top:20px; border-top:1px solid #333; padding-top:20px;">
                    <p style="color:white; text-align:center;">Confirma√ß√£o para: <strong id="confirmName" style="color:var(--text-gold)">Dr.</strong></p>
                    <div id="payment-brick_container"></div>
                </div>
            </div>
        </section>

        <section id="screen-appointments" class="hidden">
            <button class="btn-back" onclick="goTo('screen-home')">‚¨Ö Voltar</button>
            <h2 class="title-gold">Meus Agendamentos</h2>
            <div id="appointmentsList" style="margin-top: 20px;"></div>
        </section>

        <section id="screen-support" class="hidden">
            <button class="btn-back" onclick="goTo('screen-home')">‚¨Ö Voltar</button>
            <h2 class="title-gold">Fale Conosco</h2>
            <div class="dark-card" style="text-align: center;">
                <p>WB ASSESSORIA & COWORKING</p>
                <p style="color: var(--text-gold); font-size: 1.2rem; margin: 20px 0;">(11) 99999-9999</p>
                <p style="color:#666; font-size:0.9rem;">Atendimento exclusivo para advogados.</p>
            </div>
        </section>

    </main>

<script>
    // --- CONFIGURA√á√ïES ---
    const MP_PUBLIC_KEY = 'APP_USR-4509a478-fbe8-424c-ba34-f0de01106417'; 
    const WEBHOOK_URL = 'https://hook.us2.make.com/91xnrodd2h29jo8jm89jpy926f092u5g'; 
    
    // --- ESTADO ---
    let currentUser = null;
    let selectedDate = null;
    let selectedTime = null;
    let mp = null;
    let bricksBuilder = null;

    // --- M√ÅSCARAS DE INPUT (MAGIA ACONTECE AQUI) ---
    function maskCPF(i) {
        let v = i.value.replace(/\D/g, "");
        v = v.replace(/(\d{3})(\d)/, "$1.$2");
        v = v.replace(/(\d{3})(\d)/, "$1.$2");
        v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
        i.value = v;
    }
    
    function maskPhone(i) {
        let v = i.value.replace(/\D/g,"");
        v = v.replace(/^(\d{2})(\d)/g,"($1) $2");
        v = v.replace(/(\d)(\d{4})$/,"$1-$2");
        i.value = v;
    }

    function maskOAB(i) {
        let v = i.value.toUpperCase();
        // Remove tudo que n√£o √© letra ou n√∫mero
        v = v.replace(/[^A-Z0-9]/g, ""); 
        // Coloca a barra depois das duas letras da UF
        if(v.length > 2) {
            v = v.substring(0,2) + "/" + v.substring(2);
        }
        i.value = v;
    }

    // --- SISTEMA DE CADASTRO E LOGIN ---
    function doRegister() {
        const name = document.getElementById('regName').value;
        const cpf = document.getElementById('regCPF').value;
        const oab = document.getElementById('regOAB').value;
        const phone = document.getElementById('regPhone').value;
        const email = document.getElementById('regEmail').value;
        const pass = document.getElementById('regPass').value;

        if(!name || cpf.length < 14 || !oab || phone.length < 14 || !email || !pass) {
            alert("Por favor, preencha todos os dados corretamente.");
            return;
        }

        // Salvar no navegador (Simulando Banco de Dados)
        const user = { name, cpf, oab, phone, email, pass };
        localStorage.setItem('wbUser_' + email, JSON.stringify(user));
        
        alert("Cadastro realizado com sucesso! Fa√ßa login.");
        goTo('screen-login');
    }

    function doLogin() {
        const email = document.getElementById('loginEmail').value;
        const pass = document.getElementById('loginPass').value;
        
        const storedUser = localStorage.getItem('wbUser_' + email);
        
        if(storedUser) {
            const user = JSON.parse(storedUser);
            if(user.pass === pass) {
                currentUser = user;
                loginSuccess();
            } else {
                alert("Senha incorreta.");
            }
        } else {
            alert("Usu√°rio n√£o encontrado. Fa√ßa seu cadastro.");
        }
    }

    function loginSuccess() {
        document.getElementById('headerUserName').innerText = currentUser.name.split(' ')[0];
        document.getElementById('dashName').innerText = currentUser.name;
        document.getElementById('userInfo').classList.remove('hidden');
        goTo('screen-home');
    }

    function doLogout() {
        currentUser = null;
        document.getElementById('userInfo').classList.add('hidden');
        document.getElementById('loginPass').value = ''; // Limpa senha
        goTo('screen-login');
    }

    // --- NAVEGA√á√ÉO ---
    function goTo(id) {
        document.querySelectorAll('section').forEach(s => {
            s.classList.add('hidden');
            s.classList.remove('active');
        });
        const el = document.getElementById(id);
        el.classList.remove('hidden');
        el.classList.add('active');

        if(id === 'screen-appointments') loadAppointments();
    }

    // --- AGENDAMENTO (MERCADO PAGO + MAKE) ---
    try {
        mp = new MercadoPago(MP_PUBLIC_KEY, { locale: 'pt-BR' });
        bricksBuilder = mp.bricks();
    } catch(e) { console.error(e); }

    const dateInput = document.getElementById('dateInput');
    dateInput.addEventListener('change', (e) => {
        selectedDate = e.target.value;
        if(selectedDate) {
            document.getElementById('timeSection').classList.remove('hidden');
            generateSlots();
        }
    });

    function generateSlots() {
        const c = document.getElementById('slotsContainer');
        c.innerHTML = '';
        for(let i=9; i<18; i++) {
            const time = `${i<10?'0'+i:i}:00`;
            const div = document.createElement('div');
            div.className = 'slot';
            div.innerText = time;
            div.onclick = () => selectTime(time, div);
            c.appendChild(div);
        }
    }

    function selectTime(time, el) {
        document.querySelectorAll('.slot').forEach(s => s.classList.remove('selected'));
        el.classList.add('selected');
        selectedTime = time;
        document.getElementById('paymentSection').classList.remove('hidden');
        document.getElementById('confirmName').innerText = currentUser.name;
        renderBrick();
    }

    async function renderBrick() {
        document.getElementById('payment-brick_container').innerHTML = '';
        if(!bricksBuilder) return;

        const settings = {
            initialization: { amount: 50.00 },
            customization: { 
                visual: { style: { theme: 'dark' } },
                paymentMethods: { ticket: "all", bankTransfer: "all", creditCard: "all", debitCard: "all" } 
            },
            callbacks: {
                onSubmit: ({ selectedPaymentMethod, formData }) => {
                    return new Promise((resolve, reject) => {
                        sendToMake().then(resolve).catch(reject);
                    });
                },
                onError: (e) => console.error(e)
            }
        };
        window.paymentBrickController = await bricksBuilder.create("payment", "payment-brick_container", settings);
    }

    async function sendToMake() {
        const [h, m] = selectedTime.split(':').map(Number);
        let endH = h + 1;
        
        // Dados formatados para o Google Calendar e Wapi
        const googleStart = `${selectedDate}T${selectedTime}:00`;
        const googleEnd   = `${selectedDate}T${endH<10?'0'+endH:endH}:${m<10?'0'+m:m}:00`;
        const cleanPhone  = currentUser.phone.replace(/\D/g, ''); // Usa o telefone do cadastro

        const payload = {
            userName: currentUser.name,
            userPhone: cleanPhone,
            userEmail: currentUser.email,
            userCPF: currentUser.cpf,
            userOAB: currentUser.oab, // Envia OAB para o Make tamb√©m!
            date: selectedDate,
            time: selectedTime,
            googleStart: googleStart,
            googleEnd: googleEnd,
            status: "approved"
        };

        try {
            await fetch(WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            // Salvar localmente
            const apps = JSON.parse(localStorage.getItem('wbApps_' + currentUser.email) || '[]');
            apps.push({ date: selectedDate, time: selectedTime });
            localStorage.setItem('wbApps_' + currentUser.email, JSON.stringify(apps));

            alert("‚úÖ Agendamento Confirmado!");
            goTo('screen-appointments');

        } catch (error) {
            console.error(error);
            alert("Erro de conex√£o, mas tentamos registrar.");
        }
    }

    function loadAppointments() {
        const list = document.getElementById('appointmentsList');
        if(!currentUser) return;
        
        const apps = JSON.parse(localStorage.getItem('wbApps_' + currentUser.email) || '[]');
        
        if(apps.length === 0) {
            list.innerHTML = '<p style="text-align:center; color:#666;">Nenhum agendamento.</p>';
        } else {
            list.innerHTML = '';
            apps.reverse().forEach(a => {
                list.innerHTML += `
                    <div class="dark-card" style="margin-bottom:10px; border-left:4px solid var(--text-gold);">
                        <strong style="color:white;">${a.date.split('-').reverse().join('/')} √†s ${a.time}</strong>
                        <div style="color:var(--text-gold); font-size:0.8rem; margin-top:5px;">SALA PRIVATIVA CONFIRMADA</div>
                    </div>
                `;
            });
        }
    }
</script>
</body>
</html>
