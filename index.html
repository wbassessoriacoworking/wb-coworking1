<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WB Coworking | √Årea Exclusiva</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        :root {
            --bg-main: #000000;
            --bg-card: #111111;
            --text-gold: #D4AF37;
            --text-white: #ffffff;
            --text-gray: #888888;
            --input-bg: #1a1a1a;
            --input-border: #333333;
        }
        body { margin: 0; padding: 0; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: var(--bg-main); color: var(--text-white); display: flex; flex-direction: column; min-height: 100vh; }
        
        /* CABE√áALHO E RODAP√â */
        .header { display: flex; justify-content: space-between; padding: 20px; align-items: center; }
        .logo { color: var(--text-gold); font-weight: bold; letter-spacing: 1px; }
        .user-area { text-align: right; font-size: 0.8rem; color: var(--text-gray); }
        .user-name { color: var(--text-gold); display: block; font-weight: bold; }
        .btn-sair { background: transparent; border: 1px solid var(--text-gray); color: var(--text-gray); padding: 5px 15px; border-radius: 4px; cursor: pointer; margin-left: 10px; }
        .footer { text-align: center; padding: 20px; margin-top: auto; color: var(--text-gold); font-size: 0.8rem; }
        .footer small { color: var(--text-gray); }

        /* CONTAINER CENTRAL */
        .main-container { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; width: 100%; max-width: 600px; margin: 0 auto; }
        
        /* TELAS E CARDS */
        section { display: none; width: 100%; animation: fadeIn 0.5s; }
        section.active { display: block; }
        .title-gold { color: var(--text-gold); text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; color: var(--text-gray); margin-bottom: 30px; }
        .dark-card { background: var(--bg-card); padding: 30px; border-radius: 12px; border: 1px solid var(--input-border); }

        /* INPUTS E BOT√ïES */
        label { display: block; color: var(--text-gold); font-size: 0.8rem; margin-bottom: 8px; font-weight: bold; }
        input, select { width: 100%; padding: 15px; background: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-white); border-radius: 6px; margin-bottom: 20px; box-sizing: border-box; }
        input:focus { border-color: var(--text-gold); outline: none; }
        .btn-gold { width: 100%; padding: 15px; background: var(--text-gold); color: #000; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .btn-gold:hover { opacity: 0.9; }
        .btn-back { background: none; border: none; color: var(--text-gray); cursor: pointer; margin-bottom: 20px; display: flex; align-items: center; }
        .btn-back:before { content: '‚Üê '; margin-right: 5px; }

        /* DASHBOARD GRID */
        .dash-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .dash-card { background: var(--bg-card); padding: 30px; border-radius: 12px; text-align: center; border: 1px solid var(--input-border); cursor: pointer; transition: 0.3s; }
        .dash-card:hover { border-color: var(--text-gold); }
        .dash-icon { font-size: 3rem; margin-bottom: 15px; display: block; }
        .dash-title { color: var(--text-white); font-weight: bold; margin-bottom: 10px; }
        .dash-desc { color: var(--text-gray); font-size: 0.9rem; }

        /* HOR√ÅRIOS */
        .slots { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .slot { background: var(--input-bg); color: var(--text-white); padding: 10px; text-align: center; border-radius: 6px; cursor: pointer; border: 1px solid var(--input-border); }
        .slot:hover { border-color: var(--text-gold); }
        .slot.selected { background: var(--text-gold); color: #000; font-weight: bold; }
        .hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo">WB COWORKING</div>
        <div class="user-area hidden" id="loggedUserArea">
            <small>ADVOGADO(A)</small>
            <span class="user-name" id="userNameDisplay">Dr. Usu√°rio</span>
            <button class="btn-sair" onclick="doLogout()">SAIR</button>
        </div>
    </header>

    <main class="main-container">
        
        <section id="screen-login" class="active">
            <h2 class="title-gold">Bem-vindo</h2>
            <p class="subtitle">Identifique-se para acessar sua √°rea exclusiva.</p>
            <div class="dark-card">
                <label>E-MAIL PROFISSIONAL</label>
                <input type="email" id="loginEmail" placeholder="seu@email.com">
                <label>SENHA</label>
                <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                <button class="btn-gold" onclick="doLogin()">ACESSAR SISTEMA</button>
            </div>
        </section>

        <section id="screen-home">
            <h2 class="title-gold">O que deseja fazer?</h2>
            <p class="subtitle">Selecione uma op√ß√£o abaixo.</p>
            <div class="dash-grid">
                <div class="dash-card" onclick="goTo('screen-booking')">
                    <span class="dash-icon">üìÖ</span>
                    <div class="dash-title">Agendar Sala</div>
                    <div class="dash-desc">Reservar hor√°rios avulsos ou di√°ria completa.</div>
                </div>
                <div class="dash-card" onclick="goTo('screen-my-appointments')">
                    <span class="dash-icon">üìÇ</span>
                    <div class="dash-title">Minhas Reservas</div>
                    <div class="dash-desc">Ver hist√≥rico e comprovantes.</div>
                </div>
                <div class="dash-card" onclick="goTo('screen-support')">
                    <span class="dash-icon">üí¨</span>
                    <div class="dash-title">Suporte VIP</div>
                    <div class="dash-desc">Falar com a recep√ß√£o no WhatsApp.</div>
                </div>
            </div>
        </section>

        <section id="screen-booking">
            <button class="btn-back" onclick="goTo('screen-home')">Voltar</button>
            <h2 class="title-gold">Nova Reserva</h2>
            
            <div class="dark-card">
                <label>SELECIONE O DIA</label>
                <input type="date" id="dateInput" style="color-scheme: dark;"> <div id="timeSection" class="hidden">
                    <label style="margin-top: 20px;">SELECIONE O HOR√ÅRIO</label>
                    <div class="slots" id="slotsContainer"></div>
                </div>

                <div id="formSection" class="hidden" style="margin-top: 30px; border-top: 1px solid var(--input-border); padding-top: 20px;">
                    <label>NOME COMPLETO</label>
                    <input type="text" id="bookingName" placeholder="Dr. Seu Nome">
                    <label>WHATSAPP (CELULAR)</label>
                    <input type="tel" id="bookingPhone" placeholder="(11) 99999-9999">
                    
                    <div id="payment-brick_container"></div>
                </div>
            </div>
        </section>

        <section id="screen-my-appointments">
            <button class="btn-back" onclick="goTo('screen-home')">Voltar</button>
            <h2 class="title-gold" style="text-align: left;">Meus Agendamentos</h2>
            <div id="appointmentsList" style="margin-top: 30px;">
                </div>
        </section>

        <section id="screen-support">
            <button class="btn-back" onclick="goTo('screen-home')">Voltar</button>
            <h2 class="title-gold">Suporte VIP</h2>
            <div class="dark-card" style="text-align: center;">
                <p>Canal exclusivo para advogados.</p>
                <p style="color: var(--text-gold); font-size: 1.2rem; margin: 20px 0;">üìû (11) 99999-9999</p>
                <p>contato@wbcoworking.com.br</p>
            </div>
        </section>

    </main>

    <footer class="footer">
        WB COWORKING
        <br><small>SISTEMA EXCLUSIVO PARA ADVOGADOS</small>
    </footer>

<script>
    // --- SUAS CHAVES (Reais) ---
    const MP_PUBLIC_KEY = 'APP_USR-4509a478-fbe8-424c-ba34-f0de01106417'; 
    const WEBHOOK_URL = 'https://hook.us2.make.com/91xnrodd2h29jo8jm89jpy926f092u5g'; 
    
    // --- L√ìGICA DO SISTEMA ---
    let selectedDate = null;
    let selectedTime = null;
    let mp = null;
    let bricksBuilder = null;

    // Inicializa MP
    try {
        mp = new MercadoPago(MP_PUBLIC_KEY, { locale: 'pt-BR' });
        bricksBuilder = mp.bricks();
    } catch (e) { console.error("Erro MP", e); }

    // Verificar Login ao abrir
    checkLogin();

    function checkLogin() {
        const email = localStorage.getItem('userEmail');
        if(email) {
            document.getElementById('userNameDisplay').innerText = "Dr. " + email.split('@')[0];
            document.getElementById('loggedUserArea').classList.remove('hidden');
            goTo('screen-home');
        } else {
            goTo('screen-login');
        }
    }

    function doLogin() {
        const email = document.getElementById('loginEmail').value;
        if(email.includes('@')) {
            localStorage.setItem('userEmail', email);
            checkLogin();
        } else {
            alert("Digite um e-mail v√°lido.");
        }
    }

    function doLogout() {
        localStorage.removeItem('userEmail');
        location.reload();
    }

    function goTo(screenId) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
        if(screenId === 'screen-my-appointments') loadAppointments();
    }

    // --- L√ìGICA DE AGENDAMENTO (Preto/Dourado) ---
    const dateInput = document.getElementById('dateInput');
    dateInput.addEventListener('change', (e) => {
        selectedDate = e.target.value;
        if(selectedDate) {
            document.getElementById('timeSection').classList.remove('hidden');
            document.getElementById('formSection').classList.add('hidden');
            generateSlots();
        }
    });

    function generateSlots() {
        const container = document.getElementById('slotsContainer');
        container.innerHTML = '';
        for(let i=9; i<18; i++) {
            const time = `${i < 10 ? '0'+i : i}:00`;
            const div = document.createElement('div');
            div.className = 'slot';
            div.innerText = time;
            div.onclick = () => selectTime(time, div);
            container.appendChild(div);
        }
    }

    function selectTime(time, el) {
        document.querySelectorAll('.slot').forEach(s => s.classList.remove('selected'));
        el.classList.add('selected');
        selectedTime = time;
        document.getElementById('formSection').classList.remove('hidden');
        renderBrick();
    }

    async function renderBrick() {
        document.getElementById('payment-brick_container').innerHTML = '';
        if(!bricksBuilder) return;
        
        // Estiliza√ß√£o escura para o Mercado Pago
        const settings = {
            initialization: { amount: 50.00 },
            customization: { 
                visual: {
                    style: {
                        theme: 'dark', // Tenta for√ßar tema escuro nativo
                    }
                },
                paymentMethods: { ticket: "all", bankTransfer: "all", creditCard: "all", debitCard: "all" } 
            },
            callbacks: {
                onSubmit: ({ selectedPaymentMethod, formData }) => {
                    return new Promise((resolve, reject) => {
                        const name = document.getElementById('bookingName').value;
                        const phone = document.getElementById('bookingPhone').value;
                        const email = localStorage.getItem('userEmail');

                        if(!name || !phone) { alert("Preencha os dados do Dr(a)."); reject(); return; }

                        sendToMake(name, phone, email).then(() => resolve()).catch(reject);
                    });
                },
                onError: (error) => console.error(error)
            }
        };
        window.paymentBrickController = await bricksBuilder.create("payment", "payment-brick_container", settings);
    }

    // --- FUN√á√ÉO DE ENVIO (CORRIGIDA V23) ---
    async function sendToMake(name, phone, email) {
        const [h, m] = selectedTime.split(':').map(Number);
        let endH = h + 1;
        
        const googleStart = `${selectedDate}T${selectedTime}:00`;
        const googleEnd   = `${selectedDate}T${endH < 10 ? '0'+endH : endH}:${m < 10 ? '0'+m : m}:00`;
        const cleanPhone  = phone.replace(/\D/g, '');

        const payload = {
            userName: name, userPhone: cleanPhone, userEmail: email,
            date: selectedDate, time: selectedTime,
            googleStart: googleStart, googleEnd: googleEnd, status: "approved"
        };

        try {
            await fetch(WEBHOOK_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            
            // Salva local
            const bookings = JSON.parse(localStorage.getItem('wbBookingsDark') || '[]');
            bookings.push({ date: selectedDate, time: selectedTime, name: name });
            localStorage.setItem('wbBookingsDark', JSON.stringify(bookings));

            alert("‚úÖ Reserva Confirmada para Dr(a). " + name);
            goTo('screen-my-appointments');

        } catch (error) {
            console.error(error);
            alert("Reserva registrada (Instabilidade de rede).");
        }
    }

    function loadAppointments() {
        const list = document.getElementById('appointmentsList');
        const bookings = JSON.parse(localStorage.getItem('wbBookingsDark') || '[]');
        
        if(bookings.length === 0) {
            list.innerHTML = '<p style="text-align:center; color: var(--text-gray);">Nenhuma reserva encontrada.</p>';
        } else {
            list.innerHTML = '';
            bookings.reverse().forEach(b => {
                const ptDate = b.date.split('-').reverse().join('/');
                list.innerHTML += `
                    <div class="dark-card" style="margin-bottom: 15px; border-left: 4px solid var(--text-gold);">
                        <div style="color:var(--text-white); font-weight:bold; font-size:1.1rem;">${ptDate} - ${b.time}</div>
                        <div style="color:var(--text-gray); margin-top: 5px;">Sala Privativa</div>
                        <div style="color:var(--text-gold); font-size:0.9rem; margin-top:10px;">CONFIRMADO</div>
                    </div>
                `;
            });
        }
    }
</script>
</body>
</html>
